---
interface SignalStep {
  label: string;
  description?: string;
  color?: string;
  isBox?: boolean;
  boxContent?: string[];
}

interface Props {
  steps: SignalStep[];
}

const { steps } = Astro.props;

const defaultColors = [
  '#D76D77', // primary
  '#FFD97B', // yellow
  '#7BE1A4', // green
  '#979BFF', // purple
  '#FF8585', // red
  '#5BC0EB', // blue
];
---

<div class="signal-chain">
  <div class="chain-header">
    <div class="header-line"></div>
    <span class="header-text">Signal Chain</span>
    <div class="header-line"></div>
  </div>

  <div class="chain-track">
    <div class="track-line"></div>

    {steps.map((step, index) => {
      const color = step.color || defaultColors[index % defaultColors.length];
      return (
        <>
          {step.isBox ? (
            <div class="chain-box" style={`--step-color: ${color}`}>
              <div class="box-glow"></div>
              <div class="box-inner">
                <div class="box-title">{step.label}</div>
                {step.boxContent && (
                  <div class="box-chips">
                    {step.boxContent.map((item) => (
                      <span class="chip">{item}</span>
                    ))}
                  </div>
                )}
              </div>
            </div>
          ) : (
            <div class="chain-node" style={`--step-color: ${color}`}>
              <div class="node-dot">
                <div class="dot-core"></div>
                <div class="dot-ring"></div>
              </div>
              <div class="node-info">
                <span class="node-label">{step.label}</span>
                {step.description && <span class="node-desc">{step.description}</span>}
              </div>
            </div>
          )}

          {index < steps.length - 1 && (
            <div class="chain-arrow">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M12 5v14m0 0l-5-5m5 5l5-5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
          )}
        </>
      );
    })}
  </div>
</div>

<style>
  .signal-chain {
    margin: 2rem 0 2.5rem 0;
    padding: 2rem;
    background: var(--sl-color-gray-6);
    border-radius: 20px;
    border: 1px solid var(--sl-color-gray-5);
  }

  .signal-chain:first-child {
    margin-top: 0;
  }

  .chain-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .header-line {
    flex: 1;
    height: 1px;
    background: linear-gradient(90deg, transparent 0%, var(--sl-color-gray-4) 50%, transparent 100%);
  }

  .header-text {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: var(--sl-color-gray-3);
  }

  .chain-track {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    gap: 0;
  }

  .track-line {
    position: absolute;
    left: 50%;
    top: 0;
    bottom: 0;
    width: 2px;
    background: linear-gradient(180deg,
      var(--sl-color-gray-5) 0%,
      var(--sl-color-gray-4) 50%,
      var(--sl-color-gray-5) 100%
    );
    transform: translateX(-50%);
    z-index: 0;
  }

  .chain-node {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.875rem 1.25rem;
    background: var(--sl-color-bg);
    border: 1px solid var(--sl-color-gray-5);
    border-radius: 12px;
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 300px;
    transition: all 0.25s ease;
  }

  .chain-node:hover {
    border-color: var(--step-color);
    box-shadow: 0 4px 20px -8px color-mix(in srgb, var(--step-color) 40%, transparent);
    transform: scale(1.02);
  }

  .node-dot {
    position: relative;
    width: 14px;
    height: 14px;
    flex-shrink: 0;
  }

  .dot-core {
    position: absolute;
    inset: 3px;
    background: var(--step-color);
    border-radius: 50%;
  }

  .dot-ring {
    position: absolute;
    inset: 0;
    border: 2px solid var(--step-color);
    border-radius: 50%;
    opacity: 0.5;
  }

  .chain-node:hover .dot-ring {
    animation: pulse 1s ease infinite;
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 0.5; }
    50% { transform: scale(1.3); opacity: 0.2; }
  }

  .node-info {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
  }

  .node-label {
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--sl-color-text-accent);
  }

  .node-desc {
    font-size: 0.75rem;
    color: var(--step-color);
    font-family: var(--sl-font-mono);
    opacity: 0.9;
  }

  .chain-arrow {
    color: var(--sl-color-gray-4);
    padding: 0.375rem 0;
    z-index: 1;
  }

  .chain-box {
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 360px;
    border-radius: 16px;
    overflow: hidden;
    border: 1px solid var(--step-color);
  }

  .box-glow {
    position: absolute;
    inset: -1px;
    background: linear-gradient(135deg, var(--step-color) 0%, transparent 60%);
    opacity: 0.15;
  }

  .box-inner {
    position: relative;
    padding: 1.25rem;
    background: var(--sl-color-bg);
  }

  .box-title {
    font-weight: 700;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--step-color);
    text-align: center;
    margin-bottom: 1rem;
  }

  .box-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    justify-content: center;
  }

  .chip {
    font-size: 0.7rem;
    font-weight: 500;
    color: var(--sl-color-text);
    background: var(--sl-color-gray-6);
    padding: 0.375rem 0.75rem;
    border-radius: 100px;
    border: 1px solid var(--sl-color-gray-5);
    opacity: 0.8;
  }

  @media (max-width: 640px) {
    .signal-chain {
      padding: 1.5rem 1rem;
    }

    .chain-node,
    .chain-box {
      max-width: 100%;
    }
  }
</style>
