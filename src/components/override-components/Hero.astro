---
import Search from "./Search.astro";
import { Image } from 'astro:assets';
import noctisAmp from '~/assets/features/black-amp.PNG';
import rosariaAmp from '~/assets/features/pink-amp.PNG';
import luminaAmp from '~/assets/features/white-amp.PNG';

const { data } = Astro.locals.starlightRoute.entry;
const { title = data.title, tagline } = data.hero || {};
const { sidebar } = Astro.locals.starlightRoute;
const hasSidebar = Astro.locals.starlightRoute.hasSidebar;

function getFirstHref(item: any): string | null {
  if (typeof item?.href === "string" && item.href) {
    return item.href;
  }
  if (item?.entries && Array.isArray(item.entries) && item.entries.length > 0) {
    return getFirstHref(item.entries[0]);
  }
  return null; // No valid href found
}

// check if 404 page
const is404 = Astro.locals.starlightRoute?.id === "404";
---

{/* Hero Banner with Amp Images - only on homepage */}
{!hasSidebar && (
  <div class="hero-banner" id="hero-banner">
    <div class="hero-banner-overlay"></div>
    <div class="hero-banner-images">
      <Image src={noctisAmp} alt="Noctis Amplifier" class="hero-amp hero-amp-left" />
      <Image src={luminaAmp} alt="Lumina Amplifier" class="hero-amp hero-amp-center" />
      <Image src={rosariaAmp} alt="Rosaria Amplifier" class="hero-amp hero-amp-right" />
    </div>
  </div>
)}

<div
  class="hero flex flex-col items-center mx-auto px-4 sm:px-6 lg:px-8 pt-20 pb-35"
>
  <div class="hero-text-card">
    {title && <h1 set:html={title} class="mb-8 text-center rounded-2xl" />}
    {tagline && <p set:html={tagline} class="text-xl text-center" />}
  </div>
</div>

<style>
  @layer starlight.core {
    /* Hero Banner Styles */
    .hero-banner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 60vh;
      z-index: -1;
      overflow: hidden;
      transition: opacity 0.15s ease;
    }

    .hero-banner-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(
        to bottom,
        rgba(0, 0, 0, 0.4) 0%,
        rgba(0, 0, 0, 0.7) 60%,
        rgb(0, 0, 0) 100%
      );
      z-index: 1;
    }

    .hero-banner-images {
      position: absolute;
      inset: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 1rem;
      padding: 4rem 2rem 0;
    }

    .hero-amp {
      height: auto;
      max-height: 45vh;
      width: auto;
      object-fit: contain;
      opacity: 0.7;
      filter: brightness(0.85);
    }

    .hero-amp-left {
      transform: translateX(-5%) scale(0.85);
    }

    .hero-amp-center {
      transform: scale(0.95);
      z-index: 2;
      opacity: 0.85;
    }

    .hero-amp-right {
      transform: translateX(5%) scale(0.85);
    }

    /* Hero text card */
    .hero-text-card {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: 24px;
      padding: 2.5rem 3rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Hero text styles */
    h1 {
      font-size: 7rem !important;
      line-height: 6.5rem !important;
      letter-spacing: -4px;
      color: #ffffff;
      position: relative;
      z-index: 10;
    }

    .hero-text-card p {
      color: rgba(255, 255, 255, 0.85);
    }

    .hero {
      position: relative;
      z-index: 10;
    }

    .search-container {
      width: 90%;
      margin: auto;
      border: 1px solid
        color-mix(in srgb, var(--sl-color-white) 5%, transparent);
    }

    .badges {
      background-color: color-mix(
        in srgb,
        var(--sl-color-white) 3%,
        transparent
      );
    }
    .badge {
      background: color-mix(in srgb, var(--sl-color-white) 7%, transparent);
      font-size: 14px;
    }
    .badge:hover {
      background: color-mix(in srgb, var(--sl-color-white) 15%, transparent);
    }

    @media (max-width: 940px) {
      h1 {
        font-size: 3.5rem !important;
        line-height: 3.5rem !important;
        letter-spacing: -2px;
      }
      .search-container {
        width: 100%;
      }

      .hero-text-card {
        padding: 1.5rem 2rem;
        border-radius: 16px;
      }

      .hero-banner {
        height: 50vh;
      }

      .hero-banner-images {
        gap: 0.5rem;
        padding: 3rem 1rem 0;
      }

      .hero-amp {
        max-height: 30vh;
        opacity: 0.6;
      }

      .hero-amp-left,
      .hero-amp-center,
      .hero-amp-right {
        transform: scale(0.75);
      }
    }

    @media (max-width: 600px) {
      .hero-amp-left,
      .hero-amp-right {
        display: none;
      }

      .hero-amp-center {
        max-height: 35vh;
        transform: scale(0.9);
      }
    }
  }
</style>
<script>
  const iconElements = document.querySelector("[data-icon-path]");

  // make image element and add the path to src
  if (iconElements) {
    const iconPath = iconElements.getAttribute("data-icon-path");

    const img = document.createElement("img");
    img.src = `/${iconPath}` || "";
    img.alt = "icon";
    img.className =
      "hidden lg:inline-block size-20 -mb-2 rounded-2xl animate-[bounce_2s_ease-in-out_infinite]";
    iconElements.replaceWith(img);
  }

  // Scroll fade effect for hero banner
  const heroBanner = document.getElementById("hero-banner");

  if (heroBanner) {
    const fadeStart = 50;   // Start fading after 50px scroll
    const fadeEnd = 250;    // Fully faded by 250px scroll

    function handleScroll() {
      const scrollY = window.scrollY;

      if (scrollY <= fadeStart) {
        heroBanner.style.opacity = "1";
      } else if (scrollY >= fadeEnd) {
        heroBanner.style.opacity = "0";
      } else {
        const opacity = 1 - (scrollY - fadeStart) / (fadeEnd - fadeStart);
        heroBanner.style.opacity = String(opacity);
      }
    }

    window.addEventListener("scroll", handleScroll, { passive: true });
    handleScroll(); // Initial call
  }
</script>
